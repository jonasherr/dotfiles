"use strict";var p=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var L=(a,e,r)=>e in a?p(a,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[e]=r;var I=(a,e)=>{for(var r in e)p(a,r,{get:e[r],enumerable:!0})},P=(a,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of v(e))!C.call(a,i)&&i!==r&&p(a,i,{get:()=>e[i],enumerable:!(n=A(e,i))||n.enumerable});return a};var $=a=>P(p({},"__esModule",{value:!0}),a);var d=(a,e,r)=>(L(a,typeof e!="symbol"?e+"":e,r),r);var E={};I(E,{default:()=>w});module.exports=$(E);var t=require("@raycast/api"),c=require("react");var b=require("child_process"),h=require("util");var u=(0,h.promisify)(b.exec),m="'/Library/Application Support/org.pqrs/Karabiner-Elements/bin/karabiner_cli'";async function g(){try{return await u(`/bin/test -f ${m}`),!0}catch{return!1}}var s,f=(s=class{constructor(e,r){this.id=e;this.title=r}get active(){return this.title===f.activeInput}async activate(){if((await u(`${m} --select-profile '${this.id}'`)).stdout.split(`
`)[0].startsWith("[error]"))throw new Error(`Karabiner Profile "${this.title}" not found`)}static async getAll(){let[e,r]=await Promise.all([u(`${m} --list-profile-names`),u(`${m} --show-current-profile-name`)]);f.activeInput=r.stdout.split(`
`)[0];let n=e.stdout.split(`
`),i=[];for(let l of n)l.length!==0&&i.push(new s(l,l));return i}},d(s,"activeInput"),s);var o=require("react/jsx-runtime");function y(a,e){return{title:"An error occurred",message:a,style:t.Toast.Style.Failure,primaryAction:{title:"Copy Error",onAction:()=>t.Clipboard.copy(`${e}`),shortcut:{modifiers:["cmd","shift"],key:"c"}}}}async function k(a){try{await a.activate(),await Promise.all([(0,t.showHUD)(`Activated ${a.title}`),(0,t.popToRoot)(),(0,t.closeMainWindow)()])}catch(e){await(0,t.showToast)(y(`Couldn't activate ${a.title}`,`${e}`))}}function w(){let[a,e]=(0,c.useState)([]),[r,n]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{(async()=>{try{e(await f.getAll())}catch(i){if(await g())await(0,t.showToast)(y("Couldn't get profiles",`${i}`));else{n(!0);let l={...y("Karabiner Elements CLI not available",`${i}`),secondaryAction:{title:"Get Karabiner",onAction:()=>(0,t.open)("https://karabiner-elements.pqrs.org"),shortcut:{modifiers:["cmd"],key:"o"}}};await(0,t.showToast)(l)}}})()},[]),(0,o.jsx)(t.List,{isLoading:a.length===0&&!r,searchBarPlaceholder:"Search available layouts...",children:a.map(i=>(0,o.jsx)(t.List.Item,{icon:i.active?{source:t.Icon.Checkmark,tintColor:t.Color.Green}:t.Icon.Circle,title:i.title,accessories:[{text:i.active?"Current Profile":""}],keywords:[i.id],actions:(0,o.jsxs)(t.ActionPanel,{children:[(0,o.jsx)(t.Action,{icon:t.Icon.Checkmark,title:"Activate",onAction:()=>k(i)}),(0,o.jsx)(t.Action,{icon:t.Icon.Gear,title:"Open Karabiner Elements",onAction:()=>(0,t.open)("/System/Volumes/Data/Applications/Karabiner-Elements.app")})]})},i.id))})}
